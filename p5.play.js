!function(t,e){"function"==typeof define&&define.amd?define("p5.play",["@code-dot-org/p5"],function(t){e(t)}):e("object"==typeof exports?require("@code-dot-org/p5"):t.p5)}(this,function(t){function e(e,i){Object.defineProperty(t.prototype,e,{configurable:!0,enumerable:!0,get:function(){var o=this instanceof t&&!this._isGlobal?this:window;return void 0===o._p5PlayProperties&&(o._p5PlayProperties={}),e in o._p5PlayProperties||(o._p5PlayProperties[e]=i.call(o)),o._p5PlayProperties[e]}})}function i(t){if("function"!=typeof t)throw new Error("constructor must be a function");return function(){function e(){var e=Array.prototype.slice.call(arguments);return t.apply(this,[i].concat(e))}var i=this;return e.prototype=t.prototype,e}}function o(t){return function(e){var i=t[e];if("function"!=typeof i)throw new Error('"'+e+'" is not a p5 method');return i.bind(t)}}function s(t,e,i){i=i||0;var o=t.getBoundingClientRect(),s=e.touches[i]||e.changedTouches[i],n=s.clientX-o.left,r=s.clientY-o.top;if(n>=0&&n<o.width&&r>=0&&r<o.height)return{x:Math.round(n*t.offsetWidth/o.width),y:Math.round(r*t.offsetHeight/o.height),id:s.identifier}}function n(t,e){var i=t.getBoundingClientRect(),o=e.clientX-i.left,s=e.clientY-i.top;if(o>=0&&o<i.width&&s>=0&&s<i.height)return{x:Math.round(o*t.offsetWidth/i.width),y:Math.round(s*t.offsetHeight/i.height)}}function r(e,i,s,n,h){var a=o(e),l=a("createVector"),u=a("color"),p=a("print"),f=a("push"),m=a("pop"),g=a("colorMode"),y=a("tint"),S=a("lerpColor"),w=a("noStroke"),x=a("rectMode"),C=a("ellipseMode"),A=a("imageMode"),P=a("translate"),T=a("scale"),E=a("rotate"),M=a("stroke"),D=a("strokeWeight"),I=a("line"),O=a("noFill"),F=a("fill"),R=a("textAlign"),B=a("textSize"),N=a("text"),V=a("rect"),X=a("cos"),Y=a("sin"),W=a("atan2"),j=e.quadTree,H=e.camera,z=t.prototype.RGB,U=t.prototype.CENTER,k=t.prototype.LEFT,L=t.prototype.BOTTOM;this.position=l(i,s),this.previousPosition=l(i,s),this.newPosition=l(i,s),this.deltaX=0,this.deltaY=0,this.velocity=l(0,0),this.maxSpeed=-1,this.friction=0,this.collider=void 0,this.touching={},this.touching.left=!1,this.touching.right=!1,this.touching.top=!1,this.touching.bottom=!1,this.mass=1,this.immovable=!1,this.restitution=1,Object.defineProperty(this,"rotation",{enumerable:!0,get:function(){return this._rotation},set:function(t){this._rotation=t,this.rotateToDirection&&this.setSpeed(this.getSpeed(),t)}}),this._rotation=0,this.rotationSpeed=0,this.rotateToDirection=!1,this.depth=0,this.scale=1;var K=1,G=1;this.visible=!0,this.mouseActive=!1,this.mouseIsOver=!1,this.mouseIsPressed=!1,this._internalWidth=n,this._internalHeight=h,this._horizontalStretch=1,this._verticalStretch=1,Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return void 0===this._internalWidth?100:this.animation&&e._fixedSpriteAnimationFrameSizes?this._internalWidth*this._horizontalStretch:this._internalWidth},set:function(t){this.animation&&e._fixedSpriteAnimationFrameSizes?this._horizontalStretch=t/this._internalWidth:this._internalWidth=t}}),this.width=void 0===n?100:n,Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return void 0===this._internalHeight?100:this.animation&&e._fixedSpriteAnimationFrameSizes?this._internalHeight*this._verticalStretch:this._internalHeight},set:function(t){this.animation&&e._fixedSpriteAnimationFrameSizes?this._verticalStretch=t/this._internalHeight:this._internalHeight=t}}),this.height=void 0===h?100:h,this.originalWidth=this._internalWidth,this.originalHeight=this._internalHeight,this.getScaledWidth=function(){return this.width*this.scale},this.getScaledHeight=function(){return this.height*this.scale},this.removed=!1,this.life=-1,this.debug=!1,this.shapeColor=u(127,127,127),this.groups=[];var q={},Q="";this.animation=void 0,this._sweptCollider=void 0,Object.defineProperty(this,"x",{enumerable:!0,get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(this,"y",{enumerable:!0,get:function(){return this.position.y},set:function(t){this.position.y=t}}),Object.defineProperty(this,"velocityX",{enumerable:!0,get:function(){return this.velocity.x},set:function(t){this.velocity.x=t}}),Object.defineProperty(this,"velocityY",{enumerable:!0,get:function(){return this.velocity.y},set:function(t){this.velocity.y=t}}),Object.defineProperty(this,"lifetime",{enumerable:!0,get:function(){return this.life},set:function(t){this.life=t}}),Object.defineProperty(this,"bounciness",{enumerable:!0,get:function(){return this.restitution},set:function(t){this.restitution=t}}),Object.defineProperty(this,"frameDelay",{enumerable:!0,get:function(){return this.animation&&this.animation.frameDelay},set:function(t){this.animation&&(this.animation.frameDelay=t)}}),this._getBroadPhaseCollider=function(){return this.velocity.magSq()>0?this._sweptCollider:this.collider},this._doSweptCollidersOverlap=function(t){var e=this._getBroadPhaseCollider().collide(t._getBroadPhaseCollider());return 0!==e.x||0!==e.y},this._syncAnimationSizes=function(t,i){e._fixedSpriteAnimationFrameSizes||(t[i].frameChanged||void 0===this.width||void 0===this.height)&&(this._internalWidth=t[i].getWidth()*_(this._getScaleX()),this._internalHeight=t[i].getHeight()*_(this._getScaleY()))},this.update=function(){this.removed||(this._sweptCollider&&this.velocity.magSq()>0&&this._sweptCollider.updateSweptColliderFromSprite(this),this.newPosition!==this.position?this.previousPosition=l(this.newPosition.x,this.newPosition.y):this.previousPosition=l(this.position.x,this.position.y),this.velocity.x*=1-this.friction,this.velocity.y*=1-this.friction,-1!==this.maxSpeed&&this.limitSpeed(this.maxSpeed),this.rotateToDirection&&this.velocity.mag()>0&&(this._rotation=this.getDirection()),this.rotation+=this.rotationSpeed,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.newPosition=l(this.position.x,this.position.y),this.deltaX=this.position.x-this.previousPosition.x,this.deltaY=this.position.y-this.previousPosition.y,q[Q]&&(q[Q].update(),this._syncAnimationSizes(q,Q)),this.collider&&this.collider.updateFromSprite(this),this.mouseActive?(this.collider||this.setDefaultCollider(),this.mouseUpdate()):"function"!=typeof this.onMouseOver&&"function"!=typeof this.onMouseOut&&"function"!=typeof this.onMousePressed&&"function"!=typeof this.onMouseReleased||(this.mouseActive=!0,this.collider||this.setDefaultCollider(),this.mouseUpdate()),this.life>0&&this.life--,0===this.life&&this.remove())},this.setDefaultCollider=function(){q[Q]&&1===q[Q].getWidth()&&1===q[Q].getHeight()||this.setCollider("rectangle")},this.mouseUpdate=function(){var i=this.mouseIsOver,o=this.mouseIsPressed;if(this.mouseIsOver=!1,this.mouseIsPressed=!1,this.collider){var s;s=H.active?l(H.mouseX,H.mouseY):l(e.mouseX,e.mouseY),this.mouseIsOver=this.collider.overlap(new t.PointCollider(s)),this.mouseIsOver&&(e.mouseIsPressed||e.touchIsDown)&&(this.mouseIsPressed=!0),!i&&this.mouseIsOver&&void 0!==this.onMouseOver&&("function"==typeof this.onMouseOver?this.onMouseOver.call(this,this):p("Warning: onMouseOver should be a function")),i&&!this.mouseIsOver&&void 0!==this.onMouseOut&&("function"==typeof this.onMouseOut?this.onMouseOut.call(this,this):p("Warning: onMouseOut should be a function")),!o&&this.mouseIsPressed&&void 0!==this.onMousePressed&&("function"==typeof this.onMousePressed?this.onMousePressed.call(this,this):p("Warning: onMousePressed should be a function")),!o||e.mouseIsPressed||this.mouseIsPressed||void 0===this.onMouseReleased||("function"==typeof this.onMouseReleased?this.onMouseReleased.call(this,this):p("Warning: onMouseReleased should be a function"))}},this.setCollider=function(e,i,o,s,n,r){var h=e?e.toLowerCase():"";if("rectangle"===h&&(h="obb"),"point"!==h&&"circle"!==h&&"obb"!==h&&"aabb"!==h)throw new TypeError('setCollider expects the first argument to be one of "point", "circle", "rectangle", "aabb" or "obb"');if("point"===h&&1!==arguments.length&&3!==arguments.length)throw new TypeError('Usage: setCollider("'+e+'"[, offsetX, offsetY])');if("circle"===h&&1!==arguments.length&&3!==arguments.length&&4!==arguments.length)throw new TypeError('Usage: setCollider("'+e+'"[, offsetX, offsetY[, radius]])');if("aabb"===h&&1!==arguments.length&&3!==arguments.length&&5!==arguments.length)throw new TypeError('Usage: setCollider("'+e+'"[, offsetX, offsetY[, width, height]])');if("obb"===h&&1!==arguments.length&&3!==arguments.length&&5!==arguments.length&&6!==arguments.length)throw new TypeError('Usage: setCollider("'+e+'"[, offsetX, offsetY[, width, height[, rotation]]])');var a=l(i,o);"point"===h?this.collider=t.PointCollider.createFromSprite(this,a):"circle"===h?this.collider=t.CircleCollider.createFromSprite(this,a,s):"aabb"===h?this.collider=t.AxisAlignedBoundingBoxCollider.createFromSprite(this,a,s,n):"obb"===h&&(this.collider=t.OrientedBoundingBoxCollider.createFromSprite(this,a,s,n,v(r))),this._sweptCollider=new t.OrientedBoundingBoxCollider},this.mirrorX=function(t){if(1!==t&&-1!==t)return K;K=t},this.mirrorY=function(t){if(1!==t&&-1!==t)return G;G=t},this._getScaleX=function(){return e._fixedSpriteAnimationFrameSizes?this.scale*this._horizontalStretch:this.scale},this._getScaleY=function(){return e._fixedSpriteAnimationFrameSizes?this.scale*this._verticalStretch:this.scale},this.display=function(){this.visible&&!this.removed&&(f(),g(z),w(),x(U),C(U),A(U),P(this.position.x,this.position.y),E(e._angleMode===e.RADIANS?v(this.rotation):this.rotation),T(this._getScaleX()*K,this._getScaleY()*G),this.draw(),m(),this.debug&&(f(),M(0,255,0),D(1),I(this.position.x-10,this.position.y,this.position.x+10,this.position.y),I(this.position.x,this.position.y-10,this.position.x,this.position.y+10),O(),w(),F(0,255,0),R(k,L),B(16),N(this.depth+"",this.position.x+4,this.position.y-2),O(),M(0,255,0),void 0===this.collider&&this.setDefaultCollider(),this.collider&&this.collider.draw(e),m()))},this.draw=function(){if(""!==Q&&q)q[Q]&&(this.tint&&(f(),y(this.tint)),q[Q].draw(0,0,0),this.tint&&m());else{var t=this.shapeColor;this.tint&&(t=S(u(t),u(this.tint),.5)),w(),F(t),V(0,0,this._internalWidth,this._internalHeight)}},this.remove=function(){for(this.removed=!0,j.removeObject(this);this.groups.length>0;)this.groups[0].remove(this)},this.destroy=this.remove,this.setVelocity=function(t,e){this.velocity.x=t,this.velocity.y=e},this.getSpeed=function(){return this.velocity.mag()},this.getDirection=function(){var t=W(this.velocity.y,this.velocity.x);return isNaN(t)&&(t=0),e._angleMode===e.RADIANS&&(t=b(t)),t},this.addToGroup=function(t){t instanceof Array?t.add(this):p("addToGroup error: "+t+" is not a group")},this.limitSpeed=function(t){var e=this.getSpeed();if(_(e)>t){var i=t/_(e);this.velocity.x*=i,this.velocity.y*=i}},this.setSpeed=function(t,i){var o;o=void 0===i?0!==this.velocity.x||0!==this.velocity.y?e.atan2(this.velocity.y,this.velocity.x):e._angleMode===e.RADIANS?v(this._rotation):this._rotation:e._angleMode===e.RADIANS?v(i):i,this.velocity.x=X(o)*t,this.velocity.y=Y(o)*t},this.setSpeedAndDirection=this.setSpeed,this.setFrame=function(t){this.animation&&this.animation.changeFrame(t)},this.nextFrame=function(){this.animation&&this.animation.nextFrame()},this.previousFrame=function(){this.animation&&this.animation.previousFrame()},this.pause=function(){this.animation&&this.animation.stop()},this.play=function(){this.animation&&(this.animation.looping||this.animation.playing||this.animation.getFrame()!==this.animation.images.length-1||this.animation.rewind(),this.animation.play())},this.frameDidChange=function(){return!!this.animation&&this.animation.frameChanged},this.pointTo=function(t,e){var i=e-this.position.y,o=t-this.position.x;if(!(isNaN(o)||isNaN(i)||0===o&&0===i)){var s=Math.atan2(i,o);this.rotation=360*s/(2*Math.PI)}},this.addSpeed=function(t,i){var o;o=e._angleMode===e.RADIANS?v(i):i,this.velocity.x+=X(o)*t,this.velocity.y+=Y(o)*t},this.attractionPoint=function(t,e,i){var o=W(i-this.position.y,e-this.position.x);this.velocity.x+=X(o)*t,this.velocity.y+=Y(o)*t},this.addImage=function(){if("string"==typeof arguments[0]&&arguments[1]instanceof t.Image)this.addAnimation(arguments[0],arguments[1]);else{if(!(arguments[0]instanceof t.Image))throw"addImage error: allowed usages are <image> or <label>, <image>";this.addAnimation("normal",arguments[0])}},this.addAnimation=function(t){var i;if("string"!=typeof t)return p("Sprite.addAnimation error: the first argument must be a label (String)"),-1;if(arguments.length<2)return p("addAnimation error: you must specify a label and n frame images"),-1;if(arguments[1]instanceof c){var o=arguments[1].clone();return q[t]=o,""===Q&&(Q=t,this.animation=o),o.isSpriteAnimation=!0,this._internalWidth=o.getWidth()*_(this._getScaleX()),this._internalHeight=o.getHeight()*_(this._getScaleY()),o}for(var s=[],n=1;n<arguments.length;n++)s.push(arguments[n]);return i=d(e.Animation,s),q[t]=i,""===Q&&(Q=t,this.animation=i),i.isSpriteAnimation=!0,this._internalWidth=i.getWidth()*_(this._getScaleX()),this._internalHeight=i.getHeight()*_(this._getScaleY()),i},this.changeImage=function(t){this.changeAnimation(t)},this.getAnimationLabel=function(){return Q},this.changeAnimation=function(t){q[t]?(Q=t,this.animation=q[t]):p("changeAnimation error: no animation labeled "+t)},this.setAnimation=function(t){if(t!==this.getAnimationLabel()){var i=e._predefinedSpriteAnimations&&e._predefinedSpriteAnimations[t];if(void 0===i)throw new Error('Unable to find an animation named "'+t+'".  Please make sure the animation exists.');this.addAnimation(t,i),this.changeAnimation(t),e._pauseSpriteAnimationsByDefault&&this.pause()}},this.overlapPixel=function(t,e){var i=l(t,e),o=this.animation.getFrameImage();return i.x-=this.position.x-o.width/2,i.y-=this.position.y-o.height/2,!(i.x<0||i.x>o.width||i.y<0||i.y>o.height)&&(0===this.rotation&&1===this.scale?255===o.get(i.x,i.y)[3]:(p("Error: overlapPixel doesn't work with scaled or rotated sprites yet"),!1))},this.overlapPoint=function(e,i){if(this.collider||this.setDefaultCollider(),this.collider){var o=new t.PointCollider(new t.Vector(e,i));return this.collider.overlap(o)}return!1},this.overlap=function(t,e){return this._collideWith("overlap",t,e)},this.isTouching=this.overlap,this.collide=function(t,e){return this._collideWith("collide",t,e)},this.displace=function(t,e){return this._collideWith("displace",t,e)},this.bounce=function(t,e){return this._collideWith("bounce",t,e)},this.bounceOff=function(t,e){return this._collideWith("bounceOff",t,e)},this._collideWith=function(t,i,o){if(this.touching.left=!1,this.touching.right=!1,this.touching.top=!1,this.touching.bottom=!1,this.removed)return!1;var s=[];if(i instanceof r)s.push(i);else{if(!(i instanceof Array))throw"Error: overlap can only be checked between sprites or groups";void 0!==e.quadTree&&e.quadTree.active&&(s=e.quadTree.retrieveFromGroup(this,i)),0===s.length&&(s=i)}for(var n=!1,h=0;h<s.length;h++)n=this._collideWithOne(t,s[h],o)||n;return n},this._collideWithOne=function(e,i,o){if(i===this||i.removed)return!1;if(void 0===this.collider&&this.setDefaultCollider(),void 0===i.collider&&i.setDefaultCollider(),!this.collider||!i.collider)return!1;var s=this._findDisplacement(i);if(0===s.x&&0===s.y)return!1;s.x>0&&(this.touching.left=!0),s.x<0&&(this.touching.right=!0),s.y<0&&(this.touching.bottom=!0),s.y>0&&(this.touching.top=!0),"displace"!==e||i.immovable?"collide"!==e&&"bounce"!==e&&"bounceOff"!==e||this.immovable||(this.position.add(s),this.previousPosition=l(this.position.x,this.position.y),this.newPosition=l(this.position.x,this.position.y),this.collider.updateFromSprite(this)):i.position.sub(s);var n=e,r=this.immovable,h=i.immovable,a=i.restitution;if("collide"===n?(e="bounce",i.immovable=!0,i.restitution=0):"bounceOff"===n&&(e="bounce",i.immovable=!0),"bounce"===e){var u=t.Vector.project(this.velocity,s),c=t.Vector.project(i.velocity,s),p=this.mass,d=i.mass;this.immovable?(p=1,d=0):i.immovable&&(p=0,d=1);var f=p+d,m=this.restitution*i.restitution,g=t.Vector.add(t.Vector.mult(u,p),t.Vector.mult(c,d)),y=t.Vector.sub(c,u).mult(d*m).add(g).div(f),_=t.Vector.sub(u,c).mult(p*m).add(g).div(f);this.velocity.sub(u).add(y),i.velocity.sub(c).add(_)}return e=n,this.immovable=r,i.immovable=h,i.restitution=a,"function"==typeof o&&"isTouching"!==e&&o.call(this,this,i),!0},this._findDisplacement=function(e){if(this._doSweptCollidersOverlap(e)){var i=Math.max(this.collider._getMinRadius(),e.collider._getMinRadius()),o=t.Vector.sub(this.velocity,e.velocity).mag(),s=Math.max(.015,i/o);if(s<1){var n=this.position.copy(),r=e.position.copy();this.position.set(this.previousPosition),e.position.set(e.previousPosition);for(var h=t.Vector.sub(n,this.previousPosition).mult(s),a=t.Vector.sub(r,e.previousPosition).mult(s),l=s;l<1;l+=s){this.position.add(h),e.position.add(a),this.collider.updateFromSprite(this),e.collider.updateFromSprite(e);var u=this.collider.collide(e.collider);if(0!==u.x||0!==u.y)return this.immovable&&this.position.set(n),e.immovable&&e.position.set(r),u}this.position.set(n),e.position.set(r)}}return this.collider.updateFromSprite(this),e.collider.updateFromSprite(e),this.collider.collide(e.collider)}}function h(t,e,i,o){this.position=t.createVector(e,i),Object.defineProperty(this,"x",{enumerable:!0,get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(this,"y",{enumerable:!0,get:function(){return this.position.y},set:function(t){this.position.y=t}}),this.zoom=o,this.mouseX=t.mouseX,this.mouseY=t.mouseY,this.active=!1,this.isActive=function(){return this.active},this.on=function(){this.active||(a.call(t),this.active=!0)},this.off=function(){this.active&&(l.call(t),this.active=!1)}}function a(){var t=this,e=t.camera;e.init||0!==e.position.x||0!==e.position.y||(e.position.x=t.width/2,e.position.y=t.height/2,e.init=!0),e.mouseX=t.mouseX+e.position.x-t.width/2,e.mouseY=t.mouseY+e.position.y-t.height/2,e.active||(e.active=!0,t.push(),t.scale(e.zoom),t.translate(-e.position.x+t.width/2/e.zoom,-e.position.y+t.height/2/e.zoom))}function l(){var t=this;t.camera.active&&(t.pop(),t.camera.active=!1)}function u(){function t(t,e){return null===t||null===e?null===t&&null===e:"string"==typeof t?t===e:"object"!=typeof t?t===e:t.equals instanceof Function?t.equals(e):t===e}function e(t,e,i){for(var o=!1,s=0;s<this.size();s++)o=this.get(s)._collideWith(t,e,i)||o;return o}var i=[];return i.get=function(t){return i[t]},i.contains=function(t){return this.indexOf(t)>-1},i.indexOf=function(e){for(var o=0,s=i.length;o<s;++o)if(t(e,i[o]))return o;return-1},i.add=function(t){if(!(t instanceof r))throw"Error: you can only add sprites to a group";-1===this.indexOf(t)&&(i.push(t),t.groups.push(this))},i.size=function(){return i.length},i.removeSprites=function(){for(;i.length>0;)i[0].remove()},i.clear=function(){i.length=0},i.remove=function(t){if(!(t instanceof r))throw"Error: you can only remove sprites from a group";var e,o=!1;for(e=i.length-1;e>=0;e--)i[e]===t&&(i.splice(e,1),o=!0);if(o)for(e=t.groups.length-1;e>=0;e--)t.groups[e]===this&&t.groups.splice(e,1);return o},i.toArray=function(){return i.slice(0)},i.maxDepth=function(){return 0===i.length?0:i.reduce(function(t,e){return Math.max(t,e.depth)},-1/0)},i.minDepth=function(){return 0===i.length?99999:i.reduce(function(t,e){return Math.min(t,e.depth)},1/0)},i.draw=function(){this.sort(function(t,e){return t.depth-e.depth});for(var t=0;t<this.size();t++)this.get(t).display()},i.overlap=e.bind(i,"overlap"),i.isTouching=i.overlap,i.collide=e.bind(i,"collide"),i.displace=e.bind(i,"displace"),i.bounce=e.bind(i,"bounce"),i.bounceOff=e.bind(i,"bounceOff"),i.setPropertyEach=function(t,e){for(var i=0;i<this.length;i++)this[i][t]=e},i.callMethodEach=function(t){for(var e=Array.prototype.slice.call(arguments,1),i=[].concat(this),o=0;o<i.length;o++)i[o][t].apply(i[o],e)},i.setDepthEach=i.setPropertyEach.bind(i,"depth"),i.setLifetimeEach=i.setPropertyEach.bind(i,"lifetime"),i.setRotateToDirectionEach=i.setPropertyEach.bind(i,"rotateToDirection"),i.setRotationEach=i.setPropertyEach.bind(i,"rotation"),i.setRotationSpeedEach=i.setPropertyEach.bind(i,"rotationSpeed"),i.setScaleEach=i.setPropertyEach.bind(i,"scale"),i.setColorEach=i.setPropertyEach.bind(i,"shapeColor"),i.setTintEach=i.setPropertyEach.bind(i,"tint"),i.setVisibleEach=i.setPropertyEach.bind(i,"visible"),i.setVelocityXEach=i.setPropertyEach.bind(i,"velocityX"),i.setVelocityYEach=i.setPropertyEach.bind(i,"velocityY"),i.setHeightEach=i.setPropertyEach.bind(i,"height"),i.setWidthEach=i.setPropertyEach.bind(i,"width"),i.destroyEach=i.callMethodEach.bind(i,"destroy"),i.pointToEach=i.callMethodEach.bind(i,"pointTo"),i.setAnimationEach=i.callMethodEach.bind(i,"setAnimation"),i.setColliderEach=i.callMethodEach.bind(i,"setCollider"),i.setSpeedAndDirectionEach=i.callMethodEach.bind(i,"setSpeedAndDirection"),i.setVelocityEach=i.callMethodEach.bind(i,"setVelocity"),i.setMirrorXEach=i.callMethodEach.bind(i,"mirrorX"),i.setMirrorYEach=i.callMethodEach.bind(i,"mirrorY"),i}function c(e){var i,o=Array.prototype.slice.call(arguments,1),s=t.prototype.CENTER;this.images=[];var n=0,r=0,h=-1;if(this.offX=0,this.offY=0,this.frameDelay=4,this.playing=!0,this.visible=!0,this.looping=!0,this.frameChanged=!1,this.imageCollider=!1,2===o.length&&"string"==typeof o[0]&&"string"==typeof o[1]){var a=o[0],l=o[1];if(".png"!==a.substring(a.length-4,a.length)&&(e.print("Animation error: you need to use .png files (filename "+a+")"),a=-1),".png"!==l.substring(l.length-4,l.length)&&(e.print("Animation error: you need to use .png files (filename "+l+")"),l=-1),-1!==a&&-1!==l){var u=0,d=0;for(i=a.length-5;i>=0;i--)a.charAt(i)>="0"&&a.charAt(i)<="9"&&u++;for(i=l.length-5;i>=0;i--)l.charAt(i)>="0"&&l.charAt(i)<="9"&&d++;var f=a.substring(0,a.length-(4+u)),m=l.substring(0,l.length-(4+d)),g=parseInt(a.substring(a.length-(4+u),a.length-4),10),y=parseInt(l.substring(l.length-(4+d),l.length-4),10);if(y<g){var _=y;y=g,g=_}if(f!==m)this.images.push(e.loadImage(a)),this.images.push(e.loadImage(l));else{var b;if(u===d)for(i=g;i<=y;i++)b=f+e.nf(i,u)+".png",this.images.push(e.loadImage(b));else for(i=g;i<=y;i++)b=f+i+".png",this.images.push(e.loadImage(b))}}}else if(1===o.length&&o[0]instanceof p)this.spriteSheet=o[0],this.images=this.spriteSheet.frames.map(function(t){return t.spriteSourceSize&&t.sourceSize?Object.assign(t.frame,{width:t.frame.w,height:t.frame.h,sourceX:t.spriteSourceSize.x,sourceY:t.spriteSourceSize.y,sourceW:t.sourceSize.w,sourceH:t.sourceSize.h}):t.frame});else if(0!==o.length)for(i=0;i<o.length;i++)o[i]instanceof t.Image?this.images.push(o[i]):this.images.push(e.loadImage(o[i]));this.clone=function(){var t=new c(e);return t.images=[],this.spriteSheet&&(t.spriteSheet=this.spriteSheet.clone()),t.images=this.images.slice(),t.offX=this.offX,t.offY=this.offY,t.frameDelay=this.frameDelay,t.playing=this.playing,t.looping=this.looping,t},this.draw=function(t,i,o){if(this.xpos=t,this.ypos=i,this.rotation=o||0,this.visible){this.isSpriteAnimation||this.update(),e.push(),e.imageMode(s);var r=this.xpos,h=this.ypos,a=this.images[n],l=this.spriteSheet&&a;if(l){var u=(l.sourceW||l.width)-l.width,c=(l.sourceH||l.height)-l.height;r+=(l.sourceX||0)-u/2,h+=(l.sourceY||0)-c/2}e.translate(r,h),e._angleMode===e.RADIANS?e.rotate(v(this.rotation)):e.rotate(this.rotation),l?this.spriteSheet.image instanceof Image?e.imageElement(this.spriteSheet.image,l.x,l.y,l.width,l.height,this.offX,this.offY,l.width,l.height):e.image(this.spriteSheet.image,l.x,l.y,l.width,l.height,this.offX,this.offY,l.width,l.height):a?a instanceof Image?e.imageElement(a,this.offX,this.offY):e.image(a,this.offX,this.offY):e.print("Warning undefined frame "+n),e.pop()}},this.update=function(){r++;var t=n;this.frameChanged=!1,1===this.images.length&&(this.playing=!1,n=0),this.playing&&r%this.frameDelay==0&&(h>n&&-1!==h?n++:h<n&&-1!==h?n--:h===n&&-1!==h?this.playing=!1:this.looping?n>=this.images.length-1?n=0:n++:n<this.images.length-1?n++:this.playing=!1),t!==n&&(this.frameChanged=!0)},this.play=function(){this.playing=!0,h=-1},this.stop=function(){this.playing=!1},this.rewind=function(){n=0},this.changeFrame=function(t){n=t<this.images.length?t:this.images.length-1,h=-1},this.nextFrame=function(){n<this.images.length-1?n+=1:this.looping&&(n=0),h=-1,this.playing=!1},this.previousFrame=function(){n>0?n-=1:this.looping&&(n=this.images.length-1),h=-1,this.playing=!1},this.goToFrame=function(t){t<0||t>=this.images.length||(h=t)!==n&&(this.playing=!0)},this.getFrame=function(){return n},this.getLastFrame=function(){return this.images.length-1},this.getFrameImage=function(){return this.images[n]},this.getImageAt=function(t){return this.images[t]},this.getWidth=function(){return this.images[n]?this.images[n].sourceW||this.images[n].width:1},this.getHeight=function(){return this.images[n]?this.images[n].sourceH||this.images[n].height:1}}function p(e){var i=Array.prototype.slice.call(arguments,1);this.image=null,this.frames=[],this.frame_width=0,this.frame_height=0,this.num_frames=0,this._generateSheetFrames=function(){for(var t=0,e=0,i=0;i<this.num_frames;i++)this.frames.push({name:i,frame:{x:t,y:e,width:this.frame_width,height:this.frame_height}}),(t+=this.frame_width)>=this.image.width&&(t=0,(e+=this.frame_height)>=this.image.height&&(e=0))};var o=2===i.length||3===i.length,s=4===i.length||5===i.length;if(o&&Array.isArray(i[1])?(this.frames=i[1],this.num_frames=this.frames.length):s&&"number"==typeof i[1]&&"number"==typeof i[2]&&"number"==typeof i[3]&&(this.frame_width=i[1],this.frame_height=i[2],this.num_frames=i[3]),i[0]instanceof t.Image||i[0]instanceof Image)this.image=i[0],s&&this._generateSheetFrames();else{var n;if(o)i[2]?("function"==typeof i[2]&&(n=i[2]),this.image=e.loadImageElement(i[0],function(t){if(n)return n(t)},function(){if(n)return n(null)})):this.image=e.loadImage(i[0]);else if(s){var r=this._generateSheetFrames.bind(this);i[4]?("function"==typeof i[4]&&(n=i[4]),this.image=e.loadImageElement(i[0],function(t){if(r(t),n)return n(t)},function(){if(n)return n(null)})):this.image=e.loadImage(i[0],r)}}this.drawFrame=function(t,i,o,s,n){var r;if("number"==typeof t)r=this.frames[t];else for(var h=0;h<this.frames.length;h++)if(this.frames[h].name===t){r=this.frames[h];break}var a=r.frame.width||r.frame.w,l=r.frame.height||r.frame.h,u=s||a,c=n||l;if(r.spriteSourceSize&&r.sourceSize){var p=a/r.sourceSize.w,d=l/r.sourceSize.h;s?(i+=r.spriteSourceSize.x*u/r.sourceSize.w,u=s*p):i+=r.spriteSourceSize.x,n?(o+=r.spriteSourceSize.y*c/r.sourceSize.h,c=n*d):o+=r.spriteSourceSize.y}this.image instanceof Image?e.imageElement(this.image,r.frame.x,r.frame.y,r.frame.width,r.frame.height,i,o,u,c):e.image(this.image,r.frame.x,r.frame.y,r.frame.width,r.frame.height,i,o,u,c)},this.clone=function(){for(var t=new p(e),i=0;i<this.frames.length;i++){var o=this.frames[i].frame,s={name:o.name,frame:{x:o.x,y:o.y,width:o.width,height:o.height}};t.frames.push(s)}return t.image=this.image,t.frame_width=this.frame_width,t.frame_height=this.frame_height,t.num_frames=this.num_frames,t}}function d(t,e){function i(){return t.apply(this,e)}return i.prototype=t.prototype,new i}function f(t,e,i,o){this.active=!0,this.max_objects=e||10,this.max_levels=i||4,this.level=o||0,this.bounds=t,this.objects=[],this.object_refs=[],this.nodes=[]}function m(){this.quadTree.active&&(this.quadTree.updateBounds(),this.quadTree.cleanup())}function g(t){return t.filter(function(e,i){return!t.some(function(t,o){return i<o&&e.isParallel(t)})})}function y(t){return t=+t,0===t||isNaN(t)?Number(t):t>0?1:-1}t.prototype.registerMethod("init",function(){this.camera=new h(this,0,0,1),this.camera.init=!1,this.angleMode(this.DEGREES),this.frameRate(30),this._defaultCanvasSize={width:400,height:400};var t=new Date;this._startTime=t.getTime(),this._tempCanvas=document.createElement("canvas")});var _=t.prototype.abs,v=t.prototype.radians,b=t.prototype.degrees;t.prototype.originalCreateCanvas_||(t.prototype.originalCreateCanvas_=t.prototype.createCanvas,t.prototype.createCanvas=function(){var t=this.originalCreateCanvas_.apply(this,arguments);return this.fill(this.color(127,127,127)),t}),t.prototype.originalEllipse_||(t.prototype.originalEllipse_=t.prototype.ellipse,t.prototype.ellipse=function(t,e,i,o){o=(i=i||50)&&!o?i:o,this.originalEllipse_(t,e,i,o)}),t.prototype.originalRect_||(t.prototype.originalRect_=t.prototype.rect,t.prototype.rect=function(t,e,i,o){o=(i=i||50)&&!o?i:o,this.originalRect_(t,e,i,o)}),t.prototype._ontouchstart=function(t){if(this._curElement){for(var e,i=0;i<t.touches.length&&!(e=s(this._curElement.elt,t,i));i++);if(e){var o=this._isGlobal?window:this;this._updateNextTouchCoords(t),this._updateNextMouseCoords(t),this._setProperty("touchIsDown",!0),"function"==typeof o.touchStarted?!1===o.touchStarted(t)&&t.preventDefault():"function"==typeof o.mousePressed&&!1===o.mousePressed(t)&&t.preventDefault()}}},t.prototype._updateNextTouchCoords=function(t){var e=this.touchX,i=this.touchY;if("mousedown"!==t.type&&"mousemove"!==t.type&&"mouseup"!==t.type&&t.touches){if(null!==this._curElement){var o=s(this._curElement.elt,t,0);o&&(e=o.x,i=o.y);for(var n=[],r=0,h=0;h<t.touches.length;h++)(o=s(this._curElement.elt,t,h))&&(n[r]=o,r++);this._setProperty("touches",n)}}else e=this.mouseX,i=this.mouseY;this._setProperty("touchX",e),this._setProperty("touchY",i),this._hasTouchInteracted||(this._updateTouchCoords(),this._setProperty("_hasTouchInteracted",!0))},t.prototype._onmousedown=function(t){if(this._curElement&&n(this._curElement.elt,t)){var e=this._isGlobal?window:this;this._setProperty("isMousePressed",!0),this._setProperty("mouseIsPressed",!0),this._setMouseButton(t),this._updateNextMouseCoords(t),this._updateNextTouchCoords(t),"function"==typeof e.mousePressed?!1===e.mousePressed(t)&&t.preventDefault():"function"==typeof e.touchStarted&&!1===e.touchStarted(t)&&t.preventDefault()}},t.prototype._updateNextMouseCoords=function(t){var e=this.mouseX,i=this.mouseY;if("touchstart"===t.type||"touchmove"===t.type||"touchend"===t.type||t.touches)e=this.touchX,i=this.touchY;else if(null!==this._curElement){var o=n(this._curElement.elt,t);o&&(e=o.x,i=o.y)}this._setProperty("mouseX",e),this._setProperty("mouseY",i),this._setProperty("winMouseX",t.pageX),this._setProperty("winMouseY",t.pageY),this._hasMouseInteracted||(this._updateMouseCoords(),this._setProperty("_hasMouseInteracted",!0))},t.Vector.project=function(e,i){return t.Vector.mult(i,t.Vector.dot(e,i)/t.Vector.dot(i,i))},t.Vector.prototype.isParallel=function(t,e){return e="number"==typeof e?e:1e-14,Math.abs(this.x)<e&&Math.abs(t.x)<e||Math.abs(this.y)<e&&Math.abs(t.y)<e||Math.abs(this.x/t.x-this.y/t.y)<e},t.prototype.loadImageElement=function(e,i,o){var s=new Image,n=t._getDecrementPreload.apply(this,arguments);return s.onload=function(){"function"==typeof i&&i(s),n&&i!==n&&n()},s.onerror=function(e){t._friendlyFileLoadError(0,s.src),"function"==typeof o&&o!==n&&o(e)},0!==e.indexOf("data:image/")&&(s.crossOrigin="Anonymous"),s.src=e,s},t.prototype.imageElement=function(e,i,o,s,n,r,h,a,l){function u(t,e){return t>0&&t<e?t:e}if(arguments.length<=5)r=i||0,h=o||0,i=0,o=0,a=s||e.width,l=n||e.height,s=e.width,n=e.height;else{if(9!==arguments.length)throw"Wrong number of arguments to imageElement()";i=i||0,o=o||0,s=u(s,e.width),n=u(n,e.height),r=r||0,h=h||0,a=a||e.width,l=l||e.height}var c=function(e,i,o,s,n){return n===t.prototype.CORNER?{x:e,y:i,w:o,h:s}:n===t.prototype.CORNERS?{x:e,y:i,w:o-e,h:s-i}:n===t.prototype.RADIUS?{x:e-o,y:i-s,w:2*o,h:2*s}:n===t.prototype.CENTER?{x:e-.5*o,y:i-.5*s,w:o,h:s}:void 0}(r,h,a,l,this._renderer._imageMode);if(this._renderer._tint){var p=this._tempCanvas.getContext("2d");this._tempCanvas.width<c.w||this._tempCanvas.height<c.h?(this._tempCanvas.width=Math.max(this._tempCanvas.width,c.w),this._tempCanvas.height=Math.max(this._tempCanvas.height,c.h)):p.clearRect(0,0,c.w,c.h),p.drawImage(e,i,o,s,n,0,0,c.w,c.h),this._renderer.image({canvas:this._tempCanvas},0,0,c.w,c.h,c.x,c.y,c.w,c.h)}else this._renderer.image({elt:e},i,o,s,n,c.x,c.y,c.w,c.h)},e("allSprites",function(){return new t.prototype.Group}),t.prototype._mouseButtonIsPressed=function(t){return this.mouseIsPressed&&this.mouseButton===t||this.touchIsDown&&t===this.LEFT},t.prototype.mouseDidMove=function(){return this.pmouseX!==this.mouseX||this.pmouseY!==this.mouseY},t.prototype.mouseIsOver=function(t){if(!t)return!1;t.collider||t.setDefaultCollider();var e;return e=this.camera.active?this.createVector(this.camera.mouseX,this.camera.mouseY):this.createVector(this.mouseX,this.mouseY),t.collider.overlap(new window.p5.PointCollider(e))},t.prototype.mousePressedOver=function(t){return(this.mouseIsPressed||this.touchIsDown)&&this.mouseIsOver(t)};t.Renderer2D.prototype.regularPolygon=function(t,e,i,o,s){var n=this.drawingContext,r=this._doFill,h=this._doStroke;if(r&&!h){if("rgba(0,0,0,0)"===n.fillStyle)return this}else if(!r&&h&&"rgba(0,0,0,0)"===n.strokeStyle)return this;if(!(i<3)){n.beginPath(),n.moveTo(t+o*Math.cos(s),e+o*Math.sin(s));for(var a=1;a<i;a++){var l=s+2*a*Math.PI/i;n.lineTo(t+o*Math.cos(l),e+o*Math.sin(l))}n.closePath(),r&&n.fill(),h&&n.stroke()}},t.prototype.regularPolygon=function(t,e,i,o,s){if(!this._renderer._doStroke&&!this._renderer._doFill)return this;for(var n=new Array(arguments.length),r=0;r<n.length;++r)n[r]=arguments[r];return void 0===s?(s=-Math.PI/2,0==i%2&&(s+=Math.PI/i)):this._angleMode===this.DEGREES&&(s=this.radians(s)),this._renderer.isP3D||(this._validateParameters("regularPolygon",n,[["Number","Number","Number","Number"],["Number","Number","Number","Number","Number"]]),this._renderer.regularPolygon(n[0],n[1],n[2],n[3],s)),this},t.Renderer2D.prototype.shape=function(){var t=this.drawingContext,e=this._doFill,i=this._doStroke;if(e&&!i){if("rgba(0,0,0,0)"===t.fillStyle)return this}else if(!e&&i&&"rgba(0,0,0,0)"===t.strokeStyle)return this;var o=arguments.length/2;if(!(o<1)){t.beginPath(),t.moveTo(arguments[0],arguments[1]);for(var s=1;s<o;s++)t.lineTo(arguments[2*s],arguments[2*s+1]);t.closePath(),e&&t.fill(),i&&t.stroke()}},t.prototype.shape=function(){return this._renderer._doStroke||this._renderer._doFill?(this._renderer.isP3D||this._renderer.shape.apply(this._renderer,arguments),this):this},t.prototype.rgb=function(t,e,i,o){return o||(o=1),o*=255,this.color(t,e,i,o)},t.prototype.createGroup=function(){return new this.Group},e("World",function(){function t(t){Object.defineProperty(e,t,{enumerable:!0,get:function(){return this.pInst[t]}})}var e={pInst:this};return t("width"),t("height"),t("mouseX"),t("mouseY"),t("allSprites"),t("frameCount"),Object.defineProperty(e,"frameRate",{enumerable:!0,get:function(){return this.pInst.frameRate()},set:function(t){this.pInst.frameRate(t)}}),Object.defineProperty(e,"seconds",{enumerable:!0,get:function(){var t=(new Date).getTime();return Math.round((t-this.pInst._startTime)/1e3)}}),e}),t.prototype.spriteUpdate=!0,t.prototype.createSprite=function(t,e,i,o){var s=new r(this,t,e,i,o);return s.depth=this.allSprites.maxDepth()+1,this.allSprites.add(s),s},t.prototype.removeSprite=function(t){t.remove()},t.prototype.updateSprites=function(t){if(!1===t&&(this.spriteUpdate=!1),!0===t&&(this.spriteUpdate=!0),this.spriteUpdate)for(var e=0;e<this.allSprites.size();e++)this.allSprites.get(e).update()},t.prototype.getSprites=function(){if(0===arguments.length)return this.allSprites.toArray();for(var t=[],e=0;e<arguments.length;e++)for(var i=0;i<this.allSprites.size();i++)this.allSprites.get(i).isTagged(arguments[e])&&t.push(this.allSprites.get(i));return t},t.prototype.drawSprites=function(t){if("function"!=typeof(t=t||this.allSprites).draw)throw"Error: with drawSprites you can only draw all sprites or a group";t.draw()},t.prototype.drawSprite=function(t){t&&t.display()},t.prototype.loadAnimation=function(){return d(this.Animation,arguments)},t.prototype.loadSpriteSheet=function(){return d(this.SpriteSheet,arguments)},t.prototype.animation=function(t,e,i){t.draw(e,i)},e("_p5play",function(){return{keyStates:{},mouseStates:{}}});t.prototype.keyWentDown=function(t){return this._isKeyInState(t,1)},t.prototype.keyWentUp=function(t){return this._isKeyInState(t,3)},t.prototype.keyDown=function(t){return this._isKeyInState(t,2)},t.prototype._isKeyInState=function(t,e){var i,o=this._p5play.keyStates;return i="string"==typeof t?this._keyCodeFromAlias(t):t,void 0===o[i]&&(this.keyIsDown(i)?o[i]=2:o[i]=0),o[i]===e},t.prototype.mouseDown=function(t){return this._isMouseButtonInState(t,2)},t.prototype.mouseUp=function(t){return this._isMouseButtonInState(t,0)},t.prototype.mouseWentUp=function(t){return this._isMouseButtonInState(t,3)},t.prototype.mouseWentDown=function(t){return this._isMouseButtonInState(t,1)},t.prototype._clickKeyFromString=function(t){return this.CLICK_KEY[t]?this.CLICK_KEY[t]:t},t.prototype.CLICK_KEY={leftButton:t.prototype.LEFT,rightButton:t.prototype.RIGHT,centerButton:t.prototype.CENTER},t.prototype._isMouseButtonInState=function(t,e){var i=this._p5play.mouseStates;return void 0===(t=this._clickKeyFromString(t))&&(t=this.LEFT),void 0===i[t]&&(this._mouseButtonIsPressed(t)?i[t]=2:i[t]=0),i[t]===e},t.prototype.KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32," ":32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,LEFT:37,UP_ARROW:38,UP:38,RIGHT_ARROW:39,RIGHT:39,DOWN_ARROW:40,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"0NUMPAD":96,"1NUMPAD":97,"2NUMPAD":98,"3NUMPAD":99,"4NUMPAD":100,"5NUMPAD":101,"6NUMPAD":102,"7NUMPAD":103,"8NUMPAD":104,"9NUMPAD":105,MULTIPLY:106,PLUS:107,MINUS:109,DOT:110,SLASH1:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,EQUAL:187,COMMA:188,SLASH:191,BACKSLASH:220},t.prototype.KEY_DEPRECATIONS={MINUT:"MINUS",COMA:"COMMA"},t.prototype._keyCodeFromAlias=function(t){return t=t.toUpperCase(),this.KEY_DEPRECATIONS[t]&&(this._warn('Key literal "'+t+'" is deprecated and may be removed in a future version of p5.play. Please use "'+this.KEY_DEPRECATIONS[t]+'" instead.'),t=this.KEY_DEPRECATIONS[t]),this.KEY[t]},t.prototype.readPresses=function(){var t=this._p5play.keyStates,e=this._p5play.mouseStates;for(var i in t)this.keyIsDown(i)?0===t[i]?t[i]=1:t[i]=2:2===t[i]?t[i]=3:t[i]=0;for(var o in e)this._mouseButtonIsPressed(o)?0===e[o]?e[o]=1:e[o]=2:2===e[o]?e[o]=3:e[o]=0},t.prototype.useQuadTree=function(t){return void 0!==this.quadTree&&(void 0===t?this.quadTree.active:void(this.quadTree.active=!!t))},e("quadTree",function(){var t=new f({x:0,y:0,width:0,height:0},4);return t.active=!1,t}),e("Sprite",i(r)),e("Camera",i(h)),t.prototype.Group=u,t.prototype.createEdgeSprites=function(){if(this.edges)return this.edges;var t=this._curElement.elt.offsetWidth,e=this._curElement.elt.offsetHeight;return this.leftEdge=this.createSprite(-50,e/2,100,e),this.rightEdge=this.createSprite(t+50,e/2,100,e),this.topEdge=this.createSprite(t/2,-50,t,100),this.bottomEdge=this.createSprite(t/2,e+50,t,100),this.edges=this.createGroup(),this.edges.add(this.leftEdge),this.edges.add(this.rightEdge),this.edges.add(this.topEdge),this.edges.add(this.bottomEdge),this.edges},e("Animation",i(c)),e("SpriteSheet",i(p)),f.prototype.updateBounds=function(){for(var t=this.getAll(),e=1e4,i=1e4,o=-1e4,s=-1e4,n=0;n<t.length;n++)t[n].position.x<e&&(e=t[n].position.x),t[n].position.y<i&&(i=t[n].position.y),t[n].position.x>o&&(o=t[n].position.x),t[n].position.y>s&&(s=t[n].position.y);this.bounds={x:e,y:i,width:o,height:s}},f.prototype.split=function(){var t=this.level+1,e=Math.round(this.bounds.width/2),i=Math.round(this.bounds.height/2),o=Math.round(this.bounds.x),s=Math.round(this.bounds.y);this.nodes[0]=new f({x:o+e,y:s,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[1]=new f({x:o,y:s,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[2]=new f({x:o,y:s+i,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[3]=new f({x:o+e,y:s+i,width:e,height:i},this.max_objects,this.max_levels,t)},f.prototype.getIndex=function(t){if(t.collider){var e=t.collider.getBoundingBox(),i=-1,o=this.bounds.x+this.bounds.width/2,s=this.bounds.y+this.bounds.height/2,n=e.top<s&&e.bottom<s,r=e.top>s;return e.left<o&&e.right<o?n?i=1:r&&(i=2):e.left>o&&(n?i=0:r&&(i=3)),i}return-1},f.prototype.insert=function(t){if(-1===this.objects.indexOf(t)){var e,i=0;if(void 0!==this.nodes[0]&&-1!==(e=this.getIndex(t)))return void this.nodes[e].insert(t);if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels)for(void 0===this.nodes[0]&&this.split();i<this.objects.length;)-1!==(e=this.getIndex(this.objects[i]))?this.nodes[e].insert(this.objects.splice(i,1)[0]):i+=1}},f.prototype.retrieve=function(t){var e=this.getIndex(t),i=this.objects;if(void 0!==this.nodes[0])if(-1!==e)i=i.concat(this.nodes[e].retrieve(t));else for(var o=0;o<this.nodes.length;o+=1)i=i.concat(this.nodes[o].retrieve(t));return i},f.prototype.retrieveFromGroup=function(t,e){for(var i=[],o=this.retrieve(t),s=0;s<o.length;s++)e.contains(o[s])&&i.push(o[s]);return i},f.prototype.getAll=function(){for(var t=this.objects,e=0;e<this.nodes.length;e+=1)t=t.concat(this.nodes[e].getAll());return t},f.prototype.getObjectNode=function(t){var e;if(!this.nodes.length)return this;if(-1===(e=this.getIndex(t)))return this;var i=this.nodes[e].getObjectNode(t);return i||!1},f.prototype.removeObject=function(t){var e=this.getObjectNode(t),i=e.objects.indexOf(t);if(-1===i)return!1;e.objects.splice(i,1)},f.prototype.clear=function(){if(this.objects=[],this.nodes.length){for(var t=0;t<this.nodes.length;t+=1)this.nodes[t].clear();this.nodes=[]}},f.prototype.cleanup=function(){var t=this.getAll();this.clear();for(var e=0;e<t.length;e++)this.insert(t[e])},t.prototype.registerMethod("pre",t.prototype.readPresses),t.prototype.registerMethod("pre",t.prototype.updateSprites),t.prototype.registerMethod("post",m),t.prototype.registerMethod("pre",a),t.prototype.registerMethod("post",l),t.prototype.registerPreloadMethod("loadImageElement",t.prototype),t.prototype._warn=function(t){var e=window.console;e&&("function"==typeof e.warn?e.warn(t):"function"==typeof e.log&&e.log("Warning: "+t))},t.CollisionShape=function(e,i){this._localTransform=new t.Transform2D,i&&this._localTransform.rotate(i),e&&this._localTransform.translate(e),this._parentTransform=new t.Transform2D,this._center=new t.Vector,this._offset=new t.Vector,this._rotation=0,this._scale=new t.Vector(1,1),this.getsDimensionsFromSprite=!1,Object.defineProperties(this,{center:{enumerable:!0,get:function(){return this._center.copy()}.bind(this),set:function(e){this._localTransform.translate(t.Vector.mult(this._center,-1)).translate(e),this._onTransformChanged()}.bind(this)},offset:{enumerable:!0,get:function(){return this._offset.copy()}.bind(this),set:function(e){this._localTransform.translate(t.Vector.mult(this._offset,-1)).translate(e),this._onTransformChanged()}.bind(this)},rotation:{enumerable:!0,get:function(){return this._rotation}.bind(this),set:function(t){this._localTransform.clear().scale(this._scale).rotate(t).translate(this._offset),this._onTransformChanged()}.bind(this)},scale:{enumerable:!0,get:function(){return this._scale.copy()}.bind(this),set:function(t){this._localTransform.clear().scale(t).rotate(this._rotation).translate(this._offset),this._onTransformChanged()}.bind(this)}}),this._onTransformChanged()},t.CollisionShape.prototype.updateFromSprite=function(t){this.setParentTransform(t)},t.CollisionShape.prototype.setParentTransform=function(e){if(e instanceof r)this._parentTransform.clear().scale(e._getScaleX(),e._getScaleY()).rotate(v(e.rotation)).translate(e.position);else{if(!(e instanceof t.Transform2D))throw new TypeError("Bad argument to setParentTransform: "+e);this._parentTransform=e.copy()}this._onTransformChanged()},t.CollisionShape.prototype._onTransformChanged=function(){this._rotation=this._localTransform.getRotation(),this._scale=this._localTransform.getScale(),this._offset.set(0,0).transform(this._localTransform),this._center.set(this._offset.x,this._offset.y).transform(this._parentTransform)},t.CollisionShape.prototype.collide=function(e){for(var i,o,s,n=this,r=e,h=1/0,a=null,l=t.Vector.sub(r.center,n.center),u=t.CollisionShape._getCandidateAxesForShapes(n,r),c=0;c<u.length;c++){i=u[c],s=(o=t.Vector.project(l,i)).mag();var p=n._getRadiusOnAxis(i)+r._getRadiusOnAxis(i)-s;if(p<=0)return new t.Vector;p<h&&(h=p,a=0===o.x&&0===o.y?i:o)}return a.copy().setMag(-h)},t.CollisionShape.prototype.overlap=function(t){var e=this.collide(t);return 0!==e.x||0!==e.y},t.CollisionShape._getCandidateAxesForShapes=function(e,i){return g(e._getCandidateAxes(i).concat(i._getCandidateAxes(e)).map(function(e){return 0===e.x&&0===e.y?t.CollisionShape.X_AXIS:e}))},t.CollisionShape.prototype._getCandidateAxes=function(){return[]},t.CollisionShape.prototype._getRadiusOnAxis=function(){return 0},t.CollisionShape.prototype._getMinRadius=function(){return 0},t.CollisionShape.X_AXIS=new t.Vector(1,0),t.CollisionShape.Y_AXIS=new t.Vector(0,1),t.CollisionShape.WORLD_AXES=[t.CollisionShape.X_AXIS,t.CollisionShape.Y_AXIS],t.CollisionShape.prototype.getBoundingBox=function(){var e=this._getRadiusOnAxis(t.CollisionShape.X_AXIS),i=this._getRadiusOnAxis(t.CollisionShape.Y_AXIS);return{top:this.center.y-i,bottom:this.center.y+i,left:this.center.x-e,right:this.center.x+e,width:2*e,height:2*i}},t.PointCollider=function(e){t.CollisionShape.call(this,e)},t.PointCollider.prototype=Object.create(t.CollisionShape.prototype),t.PointCollider.createFromSprite=function(e,i){var o=new t.PointCollider(i);return o.setParentTransform(e),o},t.PointCollider.prototype.draw=function(t){t.push(),t.rectMode(t.CENTER),t.translate(this.center.x,this.center.y),t.noStroke(),t.fill(0,255,0),t.ellipse(0,0,2,2),t.pop()},t.CircleCollider=function(e,i){t.CollisionShape.call(this,e),this.radius=i,this._scaledRadius=0,this._computeScaledRadius()},t.CircleCollider.prototype=Object.create(t.CollisionShape.prototype),t.CircleCollider.createFromSprite=function(e,i,o){var s="number"==typeof o,n=new t.CircleCollider(i,s?o:1);return n.getsDimensionsFromSprite=!s,n.updateFromSprite(e),n},t.CircleCollider.prototype.updateFromSprite=function(t){this.getsDimensionsFromSprite&&(t.animation?this.radius=Math.max(t.animation.getWidth(),t.animation.getHeight())/2:this.radius=Math.max(t.width,t.height)/2),this.setParentTransform(t)},t.CircleCollider.prototype._onTransformChanged=function(){t.CollisionShape.prototype._onTransformChanged.call(this),this._computeScaledRadius()},t.CircleCollider.prototype._computeScaledRadius=function(){this._scaledRadius=new t.Vector(this.radius,0).transform(this._localTransform).transform(this._parentTransform).sub(this.center).mag()},t.CircleCollider.prototype.draw=function(t){t.push(),t.noFill(),t.stroke(0,255,0),t.rectMode(t.CENTER),t.ellipse(this.center.x,this.center.y,2*this._scaledRadius,2*this._scaledRadius),t.pop()},t.CircleCollider.prototype.setParentTransform=function(e){if(e instanceof r)this._parentTransform.clear().scale(Math.max(e._getScaleX(),e._getScaleY())).rotate(v(e.rotation)).translate(e.position);else{if(!(e instanceof t.Transform2D))throw new TypeError("Bad argument to setParentTransform: "+e);this._parentTransform=e.copy()}this._onTransformChanged()},t.CircleCollider.prototype._getCandidateAxes=function(e){if(e instanceof t.OrientedBoundingBoxCollider||e instanceof t.AxisAlignedBoundingBoxCollider){var i=1/0,o=null,s=e.halfDiagonals;return[t.Vector.add(e.center,s[0]),t.Vector.add(e.center,s[1]),t.Vector.sub(e.center,s[0]),t.Vector.sub(e.center,s[1])].map(function(t){return t.sub(this.center)}.bind(this)).forEach(function(t){var e=t.magSq();e<i&&(i=e,o=t)}),[o]}return[t.Vector.sub(e.center,this.center)]},t.CircleCollider.prototype._getRadiusOnAxis=function(){return this._scaledRadius},t.CircleCollider.prototype._getMinRadius=function(){return this._scaledRadius},t.AxisAlignedBoundingBoxCollider=function(e,i,o){t.CollisionShape.call(this,e),this._width=i,this._height=o,this._halfDiagonals=[],Object.defineProperties(this,{width:{enumerable:!0,get:function(){return this._width}.bind(this),set:function(t){this._width=t,this._halfDiagonals=this._computeHalfDiagonals()}.bind(this)},height:{enumerable:!0,get:function(){return this._height}.bind(this),set:function(t){this._height=t,this._halfDiagonals=this._computeHalfDiagonals()}.bind(this)},halfDiagonals:{enumerable:!0,get:function(){return this._halfDiagonals}.bind(this)}}),this._computeHalfDiagonals()},t.AxisAlignedBoundingBoxCollider.prototype=Object.create(t.CollisionShape.prototype),t.AxisAlignedBoundingBoxCollider.createFromSprite=function(e,i,o,s){var n="number"==typeof o&&"number"==typeof s,r=new t.AxisAlignedBoundingBoxCollider(i,n?o:1,n?s:1);return r.getsDimensionsFromSprite=!n,r.updateFromSprite(e),r},t.AxisAlignedBoundingBoxCollider.prototype.updateFromSprite=function(t){this.getsDimensionsFromSprite&&(t.animation?(this._width=t.animation.getWidth(),this._height=t.animation.getHeight()):(this._width=t.width,this._height=t.height)),this.setParentTransform(t)},t.AxisAlignedBoundingBoxCollider.prototype._onTransformChanged=function(){t.CollisionShape.prototype._onTransformChanged.call(this),this._computeHalfDiagonals()},t.AxisAlignedBoundingBoxCollider.prototype._computeHalfDiagonals=function(){var e=t.Transform2D.mult(this._parentTransform,this._localTransform),i=[new t.Vector(this._width/2,-this._height/2),new t.Vector(this._width/2,this._height/2),new t.Vector(-this._width/2,this._height/2)].map(function(t){return t.transform(e).sub(this.center)}.bind(this)),o=Math.max(Math.abs(i[0].x),Math.abs(i[1].x)),s=Math.max(Math.abs(i[1].y),Math.abs(i[2].y));this._halfDiagonals=[new t.Vector(o,-s),new t.Vector(o,s)]},t.AxisAlignedBoundingBoxCollider.prototype.draw=function(t){t.push(),t.rectMode(t.CENTER),t.translate(this.center.x,this.center.y),t.noFill(),t.stroke(0,255,0),t.strokeWeight(1),t.rect(0,0,2*Math.abs(this._halfDiagonals[0].x),2*Math.abs(this._halfDiagonals[0].y)),t.pop()},t.AxisAlignedBoundingBoxCollider.prototype._getCandidateAxes=function(){return t.CollisionShape.WORLD_AXES},t.AxisAlignedBoundingBoxCollider.prototype._getRadiusOnAxis=function(e){return Math.max(t.Vector.project(this._halfDiagonals[0],e).mag(),t.Vector.project(this._halfDiagonals[1],e).mag())},t.AxisAlignedBoundingBoxCollider.prototype._getMinRadius=function(){return Math.min(this._width,this._height)},t.OrientedBoundingBoxCollider=function(e,i,o,s){t.CollisionShape.call(this,e,s),this._width=i,this._height=o,this._potentialAxes=[],this._halfDiagonals=[],Object.defineProperties(this,{width:{enumerable:!0,get:function(){return this._width}.bind(this),set:function(t){this._width=t,this._onTransformChanged()}.bind(this)},height:{enumerable:!0,get:function(){return this._height}.bind(this),set:function(t){this._height=t,this._onTransformChanged()}.bind(this)},halfDiagonals:{enumerable:!0,get:function(){return this._halfDiagonals}.bind(this)}}),this._onTransformChanged()},t.OrientedBoundingBoxCollider.prototype=Object.create(t.CollisionShape.prototype),t.OrientedBoundingBoxCollider.createFromSprite=function(e,i,o,s,n){var r="number"==typeof o&&"number"==typeof s,h=new t.OrientedBoundingBoxCollider(i,r?o:1,r?s:1,n);return h.getsDimensionsFromSprite=!r,h.updateFromSprite(e),h},t.OrientedBoundingBoxCollider.prototype.updateFromSprite=t.AxisAlignedBoundingBoxCollider.prototype.updateFromSprite,t.OrientedBoundingBoxCollider.prototype.updateSweptColliderFromSprite=function(e){var i=e.velocity.mag(),o=new t.Vector(e.velocity.y,-e.velocity.x);this._width=i+2*e.collider._getRadiusOnAxis(e.velocity),this._height=2*e.collider._getRadiusOnAxis(o);var s=v(e.getDirection()),n=new t.Vector(e.newPosition.x+.5*e.velocity.x,e.newPosition.y+.5*e.velocity.y);this._localTransform.clear().scale(this._scale).rotate(s).translate(this._offset).translate(t.Vector.mult(this._center,-1)).translate(n),this._onTransformChanged()},t.OrientedBoundingBoxCollider.prototype._onTransformChanged=function(){t.CollisionShape.prototype._onTransformChanged.call(this);var e=t.Transform2D.mult(this._parentTransform,this._localTransform),i=[new t.Vector(this._width/2,-this._height/2),new t.Vector(this._width/2,this._height/2),new t.Vector(-this._width/2,this._height/2)].map(function(t){return t.transform(e)});this._halfDiagonals=[t.Vector.sub(i[0],this.center),t.Vector.sub(i[1],this.center)],this._potentialAxes=[t.Vector.sub(i[1],i[2]),t.Vector.sub(i[1],i[0])]},t.OrientedBoundingBoxCollider.prototype.draw=function(e){var i=t.Transform2D.mult(this._localTransform,this._parentTransform),o=i.getScale(),s=i.getRotation();e.push(),e.translate(this.center.x,this.center.y),e.scale(o.x,o.y),e._angleMode===e.RADIANS?e.rotate(s):e.rotate(b(s)),e.noFill(),e.stroke(0,255,0),e.strokeWeight(1),e.rectMode(e.CENTER),e.rect(0,0,this._width,this._height),e.pop()},t.OrientedBoundingBoxCollider.prototype._getCandidateAxes=function(){return this._potentialAxes},t.OrientedBoundingBoxCollider.prototype._getRadiusOnAxis=t.AxisAlignedBoundingBoxCollider.prototype._getRadiusOnAxis,t.OrientedBoundingBoxCollider.prototype._getMinRadius=t.AxisAlignedBoundingBoxCollider.prototype._getMinRadius,t.Transform2D=function(t){if(6!==(t=t||[1,0,0,0,1,0]).length)throw new TypeError("Transform2D must have six components");this.length=6,this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5]},t.Transform2D.prototype=Object.create(Array.prototype),t.Transform2D.prototype.clear=function(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=1,this[5]=0,this},t.Transform2D.prototype.copy=function(){return new t.Transform2D(this)},t.Transform2D.prototype.equals=function(e){if(!(e instanceof t.Transform2D||Array.isArray(e)))return!1;for(var i=0;i<6;i++)if(this[i]!==e[i])return!1;return!0},t.Transform2D.mult=function(e,i,o){o=o||new t.Transform2D;var s,n,r,h,a,l;s=e[0],n=e[1],r=e[2],h=e[3],a=e[4],l=e[5];var u,c,p,d,f,m;return u=i[0],c=i[1],p=i[2],d=i[3],f=i[4],m=i[5],o[0]=s*u+n*d,o[1]=s*c+n*f,o[2]=s*p+n*m+r,o[3]=h*u+a*d,o[4]=h*c+a*f,o[5]=h*p+a*m+l,o},t.Transform2D.prototype.mult=function(e){return t.Transform2D.mult(this,e,this)},t.Transform2D.prototype.translate=function(e,i){var o,s;if(e instanceof t.Vector)o=e.x,s=e.y;else{if("number"!=typeof e||"number"!=typeof i){for(var n="",r=0;r<arguments.length;r++)n+=arguments[r]+", ";throw new TypeError("Invalid arguments to Transform2D.translate: "+n)}o=e,s=i}return t.Transform2D.mult([1,0,o,0,1,s],this,this)},t.Transform2D.prototype.getTranslation=function(){return new t.Vector(this[2],this[5])},t.Transform2D.prototype.scale=function(e,i){var o,s;if(e instanceof t.Vector)o=e.x,s=e.y;else if("number"==typeof e&&"number"==typeof i)o=e,s=i;else{if("number"!=typeof e)throw new TypeError("Invalid arguments to Transform2D.scale: "+arguments);o=e,s=e}return t.Transform2D.mult([o,0,0,0,s,0],this,this)},t.Transform2D.prototype.getScale=function(){var e=this[0],i=this[1],o=this[3],s=this[4];return new t.Vector(y(e)*Math.sqrt(e*e+i*i),y(s)*Math.sqrt(o*o+s*s))},t.Transform2D.prototype.rotate=function(e){if("number"!=typeof e)throw new TypeError("Invalid arguments to Transform2D.rotate: "+arguments);var i=Math.sin(e),o=Math.cos(e);return t.Transform2D.mult([o,-i,0,i,o,0],this,this)},t.Transform2D.prototype.getRotation=function(){return Math.atan2(-this[1],this[0])},t.Vector.transform=function(t,e){return t.copy().transform(e)},t.Vector.prototype.transform=function(t){var e=this.x,i=this.y;return this.x=t[0]*e+t[1]*i+t[2],this.y=t[3]*e+t[4]*i+t[5],this}});